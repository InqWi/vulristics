from data_ms_patch_tuesday import patch_tuesday_profiles, patch_tuesday_report_configs
import functions_source_vulners
import re
import json

source_id = "August 2020"

cves_text = patch_tuesday_profiles[source_id]['cves_text']

all_cves = set()
for line in cves_text.split("\n"):
    if re.findall("^CVE", line.upper()):
        all_cves.add(line.upper())

rewrite_flag = False
ms_vulners_cve_data = dict()
n = 0
all_cves = list(all_cves)
all_cves.sort()
for cve_id in all_cves:
    print(str(n) + "/" + str(len(all_cves)) + " - " + cve_id)
    ms_vulners_cve_data[cve_id] = functions_source_vulners.get_vulners_data(cve_id, rewrite_flag)
    n += 1

print("########### Public exploit report ###########")

for cve_id in ms_vulners_cve_data:
    if ms_vulners_cve_data[cve_id]['public_exploit'] == True:
        print(cve_id)
        print(json.dumps(ms_vulners_cve_data[cve_id]['bulletins_types']['exploit'], indent=2))